<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grammar Game</title>

  <!-- üåü Confetti Library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #fceff9;
      background-image: radial-gradient(#ffd6ec 5%, transparent 6%), radial-gradient(#ffd6ec 5%, transparent 6%);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      text-align: center;
      padding: 20px;
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 18px;
      background-color: #ffaad4;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #ff90c2;
    }

    #sentence-container, #word-bank {
      margin: 20px auto;
      padding: 10px;
      border: 2px dashed #ccc;
      min-height: 60px;
      width: 80%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background-color: white;
      border-radius: 10px;
    }

    .word {
      margin: 5px;
      padding: 10px 15px;
      background: #fff6fc;
      border: 2px solid #ffaad4;
      border-radius: 10px;
      cursor: grab;
      user-select: none;
      font-size: 18px;
    }

    #stars {
      font-size: 20px;
      margin-top: 10px;
    }

    .star-float {
      position: absolute;
      top: 50%;
      left: 50%;
      font-size: 40px;
      color: gold;
      animation: floatUp 1s ease-out forwards;
      pointer-events: none;
      z-index: 10;
    }

    @keyframes floatUp {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -150%) scale(2); opacity: 0; }
    }

    #translation {
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 18px;
      color: #444;
      font-style: italic;
      min-height: 1.5em;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #translation.visible {
      opacity: 1;
    }

    #progress-container {
      width: 80%;
      height: 20px;
      margin: 20px auto 10px auto;
      background-color: #eee;
      border-radius: 20px;
      overflow: hidden;
    }

    #progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #ffaad4, #ffc0cb, #ffe0eb);
      transition: width 0.5s ease;
    }
  </style>
</head>
<body>
  <div id="start-screen">
    <h1>Grammar Game</h1>
    <button onclick="startLesson(1)">Lesson 1</button>
    <button onclick="startLesson(2)">Lesson 2</button>
  </div>

  <div id="game-screen" style="display:none;">
    <h2 id="lesson-title"></h2>

    <!-- Progress + Translation -->
    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>

    <div id="translation"></div>

    <div id="sentence-container" class="drop-zone"></div>
    <div id="word-bank"></div>
    <div id="stars">Stars: <span id="star-count">0</span></div>
    <button onclick="goBackToMenu()">Back to Main Menu</button>
  </div>

  <div id="star-animation"></div>

  <audio id="correct-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6cf3e05f70.mp3" preload="auto"></audio>

  <script>
    const lessons = {
      1: [
        {
          scrambled: ["my", "I", "homework", "did"],
          answer: ["I", "did", "my", "homework"],
          translation: "ÁßÅ„ÅØÂÆøÈ°å„Çí„Åó„Åæ„Åó„Åü„ÄÇ"
        },
        {
          scrambled: ["breakfast", "ate", "She"],
          answer: ["She", "ate", "breakfast"],
          translation: "ÂΩºÂ•≥„ÅØÊúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Åæ„Åó„Åü„ÄÇ"
        }
      ],
      2: [
        {
          scrambled: ["watch", "they", "TV", "Did"],
          answer: ["Did", "they", "watch", "TV"],
          translation: "ÂΩº„Çâ„ÅØ„ÉÜ„É¨„Éì„ÇíË¶ã„Åæ„Åó„Åü„ÅãÔºü"
        },
        {
          scrambled: ["opened", "He", "window", "the"],
          answer: ["He", "opened", "the", "window"],
          translation: "ÂΩº„ÅØÁ™ì„ÇíÈñã„Åë„Åæ„Åó„Åü„ÄÇ"
        }
      ]
    };

    let currentLesson = [];
    let currentIndex = 0;
    let stars = 0;

    function startLesson(number) {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-screen').style.display = 'block';
      document.getElementById('lesson-title').textContent = `Lesson ${number}`;
      currentLesson = lessons[number];
      currentIndex = 0;
      stars = 0;
      document.getElementById('star-count').textContent = stars;
      updateProgressBar();
      resetTranslation();
      showNextQuestion();
    }

    function goBackToMenu() {
      document.getElementById('game-screen').style.display = 'none';
      document.getElementById('start-screen').style.display = 'block';
      document.getElementById('sentence-container').innerHTML = '';
      document.getElementById('word-bank').innerHTML = '';
      document.getElementById('translation').textContent = '';
      document.getElementById('translation').classList.remove('visible');
      document.getElementById('progress-bar').style.width = '0%';
    }

    function showNextQuestion() {
      const sentence = currentLesson[currentIndex];
      if (!sentence) {
        showStarConfetti();
        setTimeout(() => alert('üéâ Lesson Complete!'), 300);
        return;
      }

      const sentenceContainer = document.getElementById('sentence-container');
      const wordBank = document.getElementById('word-bank');
      resetTranslation();
      sentenceContainer.innerHTML = '';
      wordBank.innerHTML = '';
      updateProgressBar();

      sentence.answer.forEach(() => {
        const dropSpot = document.createElement('div');
        dropSpot.className = 'word drop';
        dropSpot.textContent = '';
        dropSpot.ondragover = e => e.preventDefault();
        dropSpot.ondrop = drop;
        sentenceContainer.appendChild(dropSpot);
      });

      sentence.scrambled
        .sort(() => 0.5 - Math.random())
        .forEach(word => {
          const wordDiv = document.createElement('div');
          wordDiv.className = 'word';
          wordDiv.draggable = true;
          wordDiv.textContent = word;
          wordDiv.ondragstart = drag;
          wordBank.appendChild(wordDiv);
        });
    }

    function drag(e) {
      e.dataTransfer.setData('text', e.target.textContent);
    }

    function drop(e) {
      if (!e.target.textContent) {
        const text = e.dataTransfer.getData('text');
        e.target.textContent = text;
      }
      checkAnswer();
    }

    function checkAnswer() {
      const userAnswer = Array.from(document.querySelectorAll('#sentence-container .drop'))
        .map(div => div.textContent);

      const correct = currentLesson[currentIndex].answer;

      if (userAnswer.every((w, i) => w === correct[i])) {
        stars++;
        document.getElementById('star-count').textContent = stars;
        showStarAnimation();
        speakSentence(correct.join(' '));

        const jp = currentLesson[currentIndex].translation;
        const translation = document.getElementById('translation');
        translation.textContent = `üáØüáµ ${jp}`;
        translation.classList.add('visible');

        currentIndex++;
        setTimeout(showNextQuestion, 1800);
      }
    }

    function showStarAnimation() {
      const star = document.createElement('div');
      star.className = 'star-float';
      star.textContent = '‚≠ê';
      document.getElementById('star-animation').appendChild(star);
      setTimeout(() => star.remove(), 1000);
      document.getElementById('correct-sound').play();
    }

    function speakSentence(text) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.pitch = 1.1;
        utterance.rate = 0.9;
        utterance.volume = 1;
        speechSynthesis.speak(utterance);
      }
    }

    function updateProgressBar() {
      const progress = ((currentIndex) / currentLesson.length) * 100;
      document.getElementById('progress-bar').style.width = progress + '%';
    }

    function resetTranslation() {
      const translation = document.getElementById('translation');
      translation.textContent = '';
      translation.classList.remove('visible');
    }

    function showStarConfetti() {
      confetti({
        particleCount: 100,
        spread: 90,
        origin: { y: 0.6 },
        emojis: ["‚≠ê", "‚ú®", "üåü"],
        scalar: 1.5,
        shapes: ["text"]
      });
    }
  </script>
</body>
</html>
